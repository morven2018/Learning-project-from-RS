(()=>{"use strict";function e(e,t){const o=Array(t).fill([]);for(let a=0;a<t;a+=1)o[a]=Array.from(e[a].split(""));return o}function t(e,t,o=!0){const a=Array(t);if(o)for(let o=0;o<t;o+=1){let s=[],l=0;for(let a=0;a<t;a+=1)"1"===e[a][o]?(l+=1,a+1===t&&s.push(l)):(l>0&&s.push(l),l=0);a[o]=s}else for(let o=0;o<t;o+=1){let s=[],l=0;for(let a=0;a<t;a+=1)"1"===e[o][a]?(l+=1,a+1===t&&s.push(l)):(l>0&&s.push(l),l=0);a[o]=s}return a}function o(e,t,o,a){t%5==0&&0!=t&&o.setAttribute("style","border-left: none"),e%5==0&&0!=e&&o.setAttribute("style","border-top: none"),e%5!=4&&e!==a-1||o.setAttribute("style","border-bottom: 2px solid black"),t%5==4&&(o.setAttribute("style","border-right: 2px solid black"),e===a-1&&o.setAttribute("style","border-bottom: 2px solid black;  border-right: 2px solid black")),t===a-1&&(o.setAttribute("style","border-right: 2px solid black"),e===a-1&&o.setAttribute("style","border-bottom: 2px solid black;  border-right: 2px solid black"),e%5==4&&e!=a-1&&o.setAttribute("style","border-bottom: 2px solid black;  border-right: 2px solid black"),e%5==0&&0!=e&&o.setAttribute("style","border-top: none;  border-right: 2px solid black")),0===t&&(o.setAttribute("style","border-left: 2px solid black"),e%5==0&&0!==e&&o.setAttribute("style","border-top: none; border-left: 2px solid black"),e%5==4&&0!=e&&o.setAttribute("style","border-bottom: 2px solid black; border-left: 2px solid black "),e===a-1&&o.setAttribute("style","border-bottom: 2px solid black;  border-left: 2px solid black;")),0===e&&(o.setAttribute("style","border-top: 2px solid black"),0===t&&o.setAttribute("style","border-top: 2px solid black; border-left: 2px solid black; "),t===a-1&&o.setAttribute("style","border-top: 2px solid black; border-right: 2px solid black; "),0!==t&&t%5==0&&o.setAttribute("style","border-top: 2px solid black;  border-left: none"),t!==a-1&&t%5==4&&o.setAttribute("style","border-top: 2px solid black;  border-right: 2px solid black")),e===a-1&&t%5==0&&0!=t&&o.setAttribute("style","border-left: none;  border-bottom: 2px solid black"),e%5==4&&t%5==4&&e!==a-1&&t!==a-1&&o.setAttribute("style","border-bottom: 2px solid black;  border-right: 2px solid black"),t%5==0&&e%5==0&&0!==e&&0!==t&&o.setAttribute("style","border-left: none; border-top:none"),t%5==0&&e%5==4&&e!=a-1&&0!=t&&o.setAttribute("style","border-left: none;  border-bottom: 2px solid black"),t%5==4&&e%5==0&&0!==e&&t!==a-1&&o.setAttribute("style","border-top: none; border-right: 2px solid black")}function a(e){let t=0;return e.forEach((e=>t=t<e.length?e.length:t)),t}function s(e,t,o=!0){const s=o?"field__attempt__top-attempt":"field__attempt__left-attempt",l=o?"field__attempt__top-attempt__cell":"field__attempt__left-attempt__cell",n=a(e),r=o?`height: ${20*n+5*(n-1)}px`:`width: ${20*n+5*(n-1)}px`;e.forEach(((a,n)=>{const c=document.createElement("div");if(c.className=s,t.append(c),c.setAttribute("style",r),0===n&&o&&c.setAttribute("style","border-left: 2px solid black;"),0!==n||o||c.setAttribute("style","border-top: 2px solid black"),o&&n%5==4&&c.setAttribute("style","border-right: 2px solid black;"),o&&n%5==0&&0!=n&&c.setAttribute("style","border-left: none"),o||n%5!=0||0==n||c.setAttribute("style","border-top: none; padding-top: 4px;"),o&&n+1===e.length&&c.setAttribute("style","border-right: 2px solid black;"),o||n%5!=4||c.setAttribute("style","border-bottom: 2px solid black;"),n+1!==e.length||o||c.setAttribute("style"," border-bottom: 2px solid black;"),a.length)a.forEach((e=>{const t=document.createElement("div");t.className=l,t.textContent=e,c.append(t)}));else{const e=document.createElement("div");e.className=l,e.textContent="0",c.append(e)}}))}function l(t,o){const a=n(t),s=e(o.template,t);return a.every(((e,t)=>e.every(((e,o)=>"-1"===e||e===s[t][o]))))}function n(e){const t=document.querySelectorAll(".game-field__cell"),o=Array(e);for(let a=0;a<e;a+=1){o[a]=[];for(let s=0;s<e;s+=1)t[a*e+s].classList.contains("game-field__cell_checked")&&o[a].push("1"),t[a*e+s].classList.contains("game-field__cell_crossed")&&o[a].push("0"),t[a*e+s].classList.contains("game-field__cell_unknown")&&o[a].push("-1")}return o}function r(e=null){if(e)localStorage.setItem("level",e);else{const e=document.querySelector(".nonograms-list__tabs__active");localStorage.setItem("level",e.value)}}function c(e,t,o,a=!1,s=null){const l=document.createElement("button");l.className=t,l.textContent=o,a?e.prepend(l):e.append(l),s&&(l.value=s)}const d={Easy:5,Medium:10,Hard:15};function i(e){const t=document.querySelector("body");let o=Object.keys(localStorage).includes("level")?localStorage.getItem("level"):"Easy";const a=document.createElement("h1");a.className="game-header",a.textContent="Nonograms",t.append(a);const s=document.createElement("div");s.className="start-page-buttons",t.append(s),c(s,"start-page-buttons__random-game","Random game"),c(s,"start-page-buttons__continue-last-game","Continue last game");const l=document.createElement("main");l.classList="main",t.append(l);const n=document.createElement("div");n.classList="nonograms-list",l.append(n);const r=document.createElement("div");r.className="nonograms-list__tabs",n.append(r),function(e,t="Easy"){Object.keys(d).forEach((o=>{const a=document.createElement("div");a.textContent=`${o} (${d[o]}x${d[o]})`;let s=`nonograms-list__tabs__${o.toLowerCase()}`;a.classList.add(s),a.value=o,e.append(a),t===o&&a.classList.add("nonograms-list__tabs__active")}))}(r);const i=document.createElement("div");i.className="nonograms-list__cards",n.append(i),e.filter((e=>e.size===d[o])).forEach((e=>_(i,e)));const m=document.createElement("div");m.className="nonograms-list__records",l.append(m),function(e){const t=localStorage.getItem("nonograms"),o=document.createElement("h2");if(o.classList="nonograms-list__records__header",e.append(o),o.textContent="Records:",t){const o=JSON.parse(t);(o.length>5?o.slice(-5,-1):o).forEach(((t,o)=>{const a=document.createElement("div");a.className="nonograms-list__records__item",e.append(a);const s=document.createElement("div");s.className="records__item__position",e.append(s),s.textContent=o;const l=document.createElement("div");l.className="records__item__info",e.append(l);const n=document.createElement("h3");n.className="records__item__name",l.append(n),n.textContent=t.name;const r=document.createElement("h3");r.className="records__item__time",l.append(r),r.textContent=t.time;const c=document.createElement("h3");c.className="records__item__size",l.append(c),c.textContent=`${t.size}x${t.size}`}))}else{const t=document.createElement("div");t.className="nonograms-list__records__none",e.append(t),t.textContent="There is no records at time."}}(m)}function m(e,t){console.log(e);const o=document.querySelector(".nonograms-list__cards");o.innerHTML="",t.filter((t=>t.size===d[e])).forEach((e=>_(o,e)))}function _(e,t){const o=document.createElement("div");o.className="card",e.append(o),t.id,o.classList.add("card_done"),e.append(o);const a=document.createElement("h3");a.className="card__header",a.textContent=t.name,o.append(a);const s=document.createElement("div");s.className="cards__content",o.append(s);const l=document.createElement("div");l.className="card__preview",a.append(l);const n=document.createElement("div");n.className="card__info",s.append(n);const r=document.createElement("p");r.classList="card__timer";let d=(t.id,t.id,"00:00");r.textContent=`Time: ${d}`,n.append(r),t.id,c(n,"start-page-buttons__another-try","Play again?",!1,t.id),console.log(t.id),c(n,"start-page-buttons__continue-game","Continue"),t.id}function u(l){const n=document.querySelector("body"),r=document.createElement("div");r.className="header-of-game",n.append(r),function(e){const t=document.createElement("button");t.className="btn-return-to-start-page",t.textContent="<",t.setAttribute("aria-label","Return to chose the nonogram"),t.setAttribute("title","Return to chose the nonogram"),e.append(t)}(r);const d=document.createElement("h2");d.className="game-header__name",d.textContent=l.name,r.append(d);const i=document.createElement("div");i.className="game-area",i.value=l.id,n.append(i),function(l,n=document.querySelector("body")){const r=l.size,c=e(l.template,r);console.log(1,c);const d=document.createElement("div");d.className="field",n.append(d);const i=document.createElement("div");i.className="field-extra",d.append(i);const m=document.createElement("div");i.append(m);const _=document.createElement("div");_.className="field__attempt",i.append(_),_.setAttribute("style",`grid-template-columns: repeat(${r}, 20px);`);const u=document.createElement("div");u.className="field__additional",d.append(u);const p=document.createElement("div");p.className="field__attempt",u.append(p),p.setAttribute("style",`grid-template-rows: repeat(${r},  21px);`);const b=document.createElement("div");b.className="game-field",u.append(b),b.setAttribute("style",`grid-template-columns: repeat(${r},  20px);`);const g=t(c,r,!0),f=t(c,r,!1),v=a(f);m.setAttribute("style",`min-width: ${20*v+5*(v-1)}px`),s(g,_,!0),s(f,p,!1),console.log(2,g),console.log(3,f),function(e,t,a){for(let s=0;s<t;s+=1)for(let l=0;l<t;l+=1){const n=document.createElement("div");e[s][l],n.classList.add("game-field__cell"),n.classList.add("game-field__cell_unknown"),a.append(n),o(s,l,n,t)}}(c,r,b)}(l,i);const m=document.createElement("div");m.className="game-header__data",i.append(m);const _=document.createElement("div");_.className="game-timer",_.classList.add("game-timer__inactive"),_.textContent="Timer: 00:00:00",m.append(_);const u=document.createElement("div");u.className="bth-list",m.append(u),c(u,"start-page-buttons__save-game","Save game"),c(u,"start-page-buttons__reset-game","Reset"),c(u,"start-page-buttons__game-solution","Solution")}const p=document.querySelector("body");let b,g,f=!0;const v=new Audio("../dist/materials/sounds/win.mp3"),y=new Audio("../dist/materials/sounds/error.mp3"),h=new Audio("../dist/materials/sounds/checked.mp3"),x=new Audio("../dist/materials/sounds/blank.mp3");function E(e){console.log("clear"),["game-field__cell_unknown","game-field__cell_checked","game-field__cell_crossed"].forEach((t=>{e.classList.contains(t)&&e.classList.remove(t)}))}window.onload=function(e,t="Easy"){p.classList.add("start-page"),console.log("1"),fetch("../dist/materials/data/nonogramm.json").then((e=>e.json())).then((e=>{b=e,void 0===localStorage.level?console.log("wtf"):r("Easy"),i(b)}))},p.addEventListener("click",(t=>{if("game-field__cell"===t.target.classList[0]){f&&(f=!1,g=new Date),t.target.classList.contains("game-field__cell_checked")?(E(t.target),t.target.classList.add("game-field__cell_unknown"),y.play()):(E(t.target),t.target.classList.add("game-field__cell_checked"),h.play());const o=document.querySelector(".game-area").value;if(l(d[localStorage.level],b[o-1])&&function(t,o){const a=n(t),s=e(o.template,t);return a.every(((e,t)=>e.every(((e,o)=>"0"===("-1"===e&&s[t][o])||e===s[t][o]))))}(d[localStorage.level],b[o-1])){const e=new Date;console.log("You win!",`${g} ${e} ${e-g}`),v.play(),f=!0}else l(d[localStorage.level],b[o-1])||console.log("Make error")}if("start-page-buttons__another-try"!==t.target.classList[0]&&"start-page-buttons__new-game"!==t.target.classList[0]||(console.log(b,t.target.value,b[t.target.value-1]),r(),function(){const e=document.querySelector(".main");e&&e.remove();const t=document.querySelector(".start-page-buttons");t&&t.remove()}(),u(b[t.target.value-1])),"nonograms-list__tabs__easy"===t.target.classList[0]){const e=document.querySelector(".nonograms-list__tabs__easy");e.classList.add("nonograms-list__tabs__active"),document.querySelector(`.nonograms-list__tabs__${localStorage.level.toLowerCase()}`).classList.remove("nonograms-list__tabs__active"),localStorage.level=e.value,m(localStorage.level,b)}if("nonograms-list__tabs__medium"===t.target.classList[0]){const e=document.querySelector(".nonograms-list__tabs__medium");e.classList.add("nonograms-list__tabs__active"),document.querySelector(`.nonograms-list__tabs__${localStorage.level.toLowerCase()}`).classList.remove("nonograms-list__tabs__active"),localStorage.level=e.value,m(localStorage.level,b)}if("nonograms-list__tabs__hard"===t.target.classList[0]){const e=document.querySelector(".nonograms-list__tabs__hard");e.classList.add("nonograms-list__tabs__active"),document.querySelector(`.nonograms-list__tabs__${localStorage.level.toLowerCase()}`).classList.remove("nonograms-list__tabs__active"),localStorage.level=e.value,m(localStorage.level,b)}"btn-return-to-start-page"===t.target.classList[0]&&(function(){const e=document.querySelector(".header-of-game");e&&e.remove();const t=document.querySelector(".game-area");t&&t.remove();const o=document.querySelector(".game-header");o&&o.remove()}(),i(b))})),p.addEventListener("contextmenu",(e=>{if("game-field__cell"===e.target.classList[0]){f&&(f=!1,g=new Date),e.target.classList.contains("game-field__cell_crossed")?(E(e.target),e.target.classList.add("game-field__cell_unknown"),y.play()):(E(e.target),e.target.classList.add("game-field__cell_crossed"),x.play());const t=document.querySelector(".game-area").value;l(d[localStorage.level],b[t-1])||console.log("Make error cross"),e.preventDefault()}}))})();